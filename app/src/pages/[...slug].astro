---
import Layout from '../layouts/Layout.astro';
import TableOfContents from '../components/TableOfContents';
import { getAllNotes, getNoteBySlug } from '../lib/notes';
import { getCategories } from '../lib/categories';
import { renderMarkdown } from '../lib/markdown';

export function getStaticPaths() {
  getCategories();
  const notes = getAllNotes();
  return notes.map((note) => ({
    params: { slug: note.slug },
  }));
}

const { slug } = Astro.params;
getCategories();
const note = getNoteBySlug(slug!);

if (!note) {
  return Astro.redirect('/');
}

const html = renderMarkdown(note.content);
const hasToc = note.headings.length >= 3;
---

<Layout title={`${note.title} â€” Spanish Notes`}>
  <!-- Breadcrumb -->
  <div class="flex items-center gap-2 text-xs text-slate-500 mb-6">
    <a href="/" class="hover:text-white transition-colors">&larr; Directory</a>
    <span>/</span>
    <span>{note.category}</span>
  </div>

  <h1 class="text-3xl font-bold text-white tracking-tight mb-8">{note.title}</h1>

  <div class:list={['relative', hasToc && 'lg:grid lg:grid-cols-[minmax(0,1fr)_200px] lg:gap-16']}>
    <article class="prose prose-invert prose-lg max-w-3xl">
      <Fragment set:html={html} />
    </article>

    {hasToc && (
      <aside class="hidden lg:block">
        <div class="sticky top-20">
          <TableOfContents client:load headings={note.headings} />
        </div>
      </aside>
    )}
  </div>
</Layout>
